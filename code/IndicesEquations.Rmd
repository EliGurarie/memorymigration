---
title: "Indices Equations"
author: "E. Gurarie, S. Potluri, B. Fagan, others"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: yes
    toc_float: yes
---


Simulations are run until a (quasi)-equilibrium state is achieved, where "state" refers to the population distribution across an entire year. Once that state is attained, we obtain three metrics that characterize the spatial distribution, the migratory behavior, and the foraging efficiency. All of these indices are constrained to be between 0 and 1.   


## Migratoriness 

To determine the migratoriness of a population, we calculate overlap of the population from two different times within the year, choosing those times to minimize the overlap, and reporting the overall overlap.  The overlap is defined as:

$$O(t_1, t_2) = \int_D \sqrt{u(x, t_1) \, u(x, t_2)} \, dx; $$
After calcuating this overlap of the two matrices that contain the population, we find the values of $t_1$ and $t_2$ that minimize $O$, corresponding to the periods of maximum distance. We subtract this minimum value to calculate migratoriness of the population. Thus, the migratoriness index (MI) is:

$$MI = 1-min(O(t_1, t_2))$$

```{r}
 computeMigratoriness <- function(pop, world){

  dx <- world$dx
  tau <- world$tau
  
  Overlap <- matrix(NA, tau, tau)
  for(i in 1:(tau-1))
    for(j in (i+1):tau)
      Overlap[i,j] <- sum(sqrt(pop[i,] * pop[j,])) * dx
  
  minOverlap <-  1-min(Overlap, na.rm = TRUE)
  list(times = which(Overlap == minOverlap, arr.ind = TRUE),
       overlap = minOverlap)
}
  

```

## Foraging Efficiency 


To quantify the consumers’ ability to track the distribution of their resources over space and time, we use the continuous form of the Bhattacharyya Coefficient (Bhattacharyya 1943).  The Bhattacharyya Coefficient quantifies similarity between two distributions; we take the mean of the coefficient over the equilibrium year to determine foraging efficiency (FE). Thus, the foraging efficiency index is: 
$$FE = {1\over \tau} \int_{0}^\tau \int_{0}^{X_{max}} \sqrt{u(x,t) \, h(x,t)} \, dx\,dt$$
Where the spatial integral is taken over the domain.  


```{r}
computeEfficiency <- function(pop, resource, world){
  
  dx <- world$dx
  tau <- world$tau
  
  Similarity <- matrix(NA, tau, tau)
  for(i in 1:(tau-1))
    for(j in (i+1):tau)
      Similarity[i,j] <- sum(sqrt(pop[i,] * resource[j,])) * dx
  
  FS <- mean(Similarity, na.rm=TRUE)/tau
}
```


## Social Cohesion

To measure the social cohesion (SC) of a population, we simply calculate the mean standard deviation of the population across the equilibrium year:

$$\overline{\sigma} = {1\over \tau} \int \sigma_u(x,t) \,dt$$

where $$\sigma_u^2(t) = \int_D \left(x - \mu_u(t)\right)^2 \, u(x,t)\, dx$$

and $\mu_u$ is the mean of $u$ at time $t$.  If the population is uniformly distributed over the domain, the standard deviation of the model would be $\frac{X_{max}}{\sqrt{12}}$.  We therefore define the social cohesion (SC) index as: $$SC = 1-\frac{\sqrt{12} \, }{X_{max}}\overline{\sigma}$$

where $\sigma_{max}=\frac{1}{\sqrt{12}}.$  In theory, SC can be lower than 1 if, for example, the population concentrates in two groups at the edges of the domain, but in practice the SC is positive.  The maximum value of 1 would correspond to the entire population . 
```{r}
 getSD <- function(pop, world){
    EX <- sum( world$X * pop) * world$dx
    EX2 <- sum( world$X^2 * pop) * world$dx
    sd  = sqrt(EX2 - EX^2)
  }

  computeCohesiveness <- function(pop){
    SDs <- apply(pop, 1, getSD, world = world)
    SD.max <- (1/sqrt(12))*max(world$X)
    SC <- 1 - SDs/SD.max
    c(SC.mean = mean(SC), SC.sd = sd(SC))
  }

```

## Combining the Indices
The following function calculates these three indices for a specific population and resource. 
```{r}
computeIndices <- function(pop, resource, world){
  SC = computeCohesiveness(pop, world)["SC.mean"]
  MI = computeMigratoriness(pop, world)$overlap
  FE = computeEfficiency(pop, resource, world)
  data.frame(SC, MI, FE)
}
```

## References  
Bhattacharyya, A. (1943). "On a measure of divergence between two statistical populations defined by their probability distributions". Bulletin of the Calcutta Mathematical Society. 35: 99–109. MR 0010358

```

