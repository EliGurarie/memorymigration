---
title: "Modeling memory and taxis to analyze migrations"
author: "E. Gurarie, S. Potluri, B. Fagan, others"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: yes
    toc_float: yes
theme: cerulean
editor_options:
  chunk_output_type: console
bibliography: ../library/memorymigration.bib
csl: ecology.csl
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache = TRUE, message = FALSE, warning = FALSE, eval = FALSE)
```

# Introduction

Seasonal migrations are an extremely widespread among terrestrial, aquatic, avian and invertebrate species [@Dingle2014].  For many species, migration is an extremely successful strategy, allowing a far greater number of individuals to inhabit landscape which might not otherwise be able to support large numbers year round [@Fryxell1996]. The ultimate evolutionary cause of seasonal migration, essentially, is that the energetic and survival related costs of migration are outweighed by the fitness benefits of accessing suitable seasonal resources, whether those are for energetic gain, predator avoidance, a suitable physical, biotic or social environment for reproduction [@Avgar2013]. 

Much as the ultimate causes of migration vary across species, the proximate causes, drivers and mechanism can vary considerably across and even within species [@Shaw2016]. Some migrants follow a "green wave" of spring vegetation as it flowers across altitudinal or latitudinal gradients [@Bischof2012;@Kolzsch2015]. These migrations can be considered "tactical", as they can occur - as an extreme simplification - purely as  response to local conditions.   Other migrants perform long-distance migrations in anticipation that critical resources will be available at the time of arrival at the end point of migration (**refs**).  This second behavior involves the greatest trade-off between the costs of migration against the benefits of accessing resources, whether food, suitable habitat for breeding, or predator refuge, that are highly seasonal and localized (**refs**).  This approach can be considered "strategic" in the sense that it is driven not by immediate cues but by a remembered anticipation [@Bracis2017].

Migratory species are often considered to be more vulnerable to environmental change, as a disruption in either of the seasonal ranges or along a migratory corridor can have significant negative impacts [@Wilcove2008;@Kauffman2021].  On the other hand, it has been argued that migratory species might be more resilient to disruptions due to their wide-ranging mobility [@Robinson2009]. Clearly, the ability to perform a migration without local cues in only possible if the behavior is hard-cued or remembered.  On the other hand, a strictly programmed behavior can be maladaptive if conditions change. 

Here, we explore the relationship between memory and resource following for a migratory population under various static and dynamic seasonal resource distributions using a diffusion-advection model.  

Diffusion-advection models have a long pedigree in animal movement modeling [@Skellam1951;@Turchin1998;@Okubo2001]. These models are grounded in the general idea that animal movements - somewhat like movements of physical particles - combine a random (diffusive) component with a directed (advective) component. While direct relationships between diffusion models and movement data are somewhat tenuous [@Gurarie2011a], as a theoretical tool for exploring processes they are invaluable for their versatility and the relative ease of numeric computation of the partial differential equations (PDEs) that are used to describe diffusion-advection models mathematically. Thus, much theoretical and some applied work has been done on refining the basic assumptions of diffusion models, e.g. by including heterogeneity in populations [@Skalski2003;@Gurarie2009], fat-tailed dispersal kernels [@Kot1996], non-linear or otherwise complex responses to resources and consepecifics (**refs**).  

Perhaps the greatest difference between animals and randomly moving passive particles described by diffusion models is cognition, including social behavior and memory. Refinements to diffusion-advection equations have revealed conditions under which non-local information gathering [@Fagan2017] and behavioral switching may confer foraging advantages [@Fagan2019], in particular when resources are dynamic and patchy. The interacting role of memory and sociality, in contrast, have been comparatively little studied. 

We anticipate that under many conditions a blending of *tactical* (i.e. direct response to resource availability or perception) and *strategic* (i.e. memory-driven and forward-thinking) behavior help foragers navigate dynamic, seasonal resource environments.  


# Methods

## Memory movement model

Our model is an advection diffusion with two advective terms corresponding to a direct response to the environment and to memory. The *tactical* process is positive response to a resource gradient, while the *collective memory* corresponds to a tendency of the organisms to repeat the behavior of the population in previous years.  Thus: 

$${\frac{\partial u(x,t)}{\partial t}} = -\varepsilon {\frac{\partial^2 u(x,t)}{\partial x^2}} + 
\alpha \frac{\partial}{\partial x}\left(u(x,t) \frac{\partial h(x,t)}{\partial x}\right) + 
\beta  \frac{\partial}{\partial x}\left(u(x,t) \frac{\partial m(x,t)}{\partial x}\right) \,\,\,\,(1)$$

where the variables $u(x,t)$ represents a population distributed in time and space, $h(x,t)$ is the distribution of the resource, $m(x,t,y)$ is the memory component in space and time at (discrete) year $y$, $\varepsilon$ is a rate of randomness (diffusion), $\alpha$ is the strength of advection in the direction of the resource $h(x,t)$ gradient), and $\beta$ is the strength of advection up the memory gradient.  The memory component we model as a mixture of a reference (long-term) memory, modified by more recent experiences as follows:
$$m(x,t) = \kappa^y \, u(x, t - y\tau) + \left(1-\kappa^y\right)\,u(x, t-\tau)\,\,\,\,(2)$$
Here, $y \in \{0,1,2,...\}$ represents the count of a given year, i.e. $y = \lfloor t/\tau \rfloor$. Thus, $u(x, t - y\tau)$ is the initial (year 0) "learned" collective behavior, $u(x, t-\tau)$ is the preceding year's collective behavior and $\kappa \in (0,1)$ is the relative contribution of the long-term (reference) memory.   When $\kappa = 1$, all of the memory is reference memory, and the system essentially responds to it's initial learned behavior as if it were a resource. If $\kappa = 0$, the memory is entirely short-term, and the process responds only to the behavior from the previous year.  With $0 < \kappa < 1$, the reference memory fades with time.  The model is confined to a one-dimensional bounded domain $[0,\chi]$, with no flux outside of the boundaries i.e. ${\frac{\partial u(0,t)}{\partial t}} = {\frac{\partial u(\chi,t)}{\partial t}} =0$,  Thus the total population is fixed at all times and found within the domain. 

A few special cases of this model have been studied in the past. @Shigesada1979 (section 3) thoroughly analyzed the resource following diffusion model with no memory and a static resource (i.e.~$\beta = 0$ and $h(x,t) = h(x)$), showing that at equilibrium, the log of the population density is proportional to $h(x)/\alpha$.  @Shi2019 consider a single period memory model ($\kappa = 0$) in detail, with the addition of an independent birth-death process. Importantly, the authors prove the wellposedness (existence, uniqueness, and positivity) of this model, with arguments that are equally valid for our model. @Fagan2017 numerically explored an extension of this model with no memory but a dynamic resource and the addition of non-local information, i.e.~a model where the resource $h(x,t)$ is "perceived" via a convolution with a detection function. @Fagan2019 added a behavioral switching behavior to the non-local information model.  This study 

Note, this model does not contain any explicit birth or death processes, the population is fixed, and the parameters remain constant throughout time.  Our interest is entirely in the ability of a fixed set of memory and movement parameters to ``navigate'' a dynamic environment.  


## Environment and seasonal resource

We ran our numerical experiments on a spatial domain ranging from 0 to $\chi = 100$, and a period of duration $\tau = 100$ (i.e.~a 100 day "year").  We are interested in an approximately periodic resource dynamic, i.e. one in which $h(x,t \approx h(x, t-\tau))$ and $\tau$ is the period of the process. Furthermore, we were mainly interested in a "non-surfable" resource where the patches are isolated and pulse periodically.  

Thus, the resource model consists of two bivariate normal pulses centered at $\mu_p$ at $t_p$ and $\chi - \mu_p$ at $\tau - t_p$ (e.g. location 80 and 20 at times 25 and 75, respectively). These pulses have a shared time scale of duration $\sigma_t$ and a spatial scale of extent $\sigma_x$, the standard deviation in the time and space dimension respectively.  This flexible formulation allows us to compare long (duration) and narrow (spatially), long and wide, short and narrow, and short and wide pulses, and to easily simulate scenarios where there is drift or randomness in the location or timing of the pulses. Note that in order to make the magnitude of the resource pulse comparable to the magnitude of the memory, which integrates to 1 at every time point, we normalize the resource such that its average value across the year is also 1.  

## Metrics

The main metrics we are interested are *migratoriness* and *foraging efficiency*.  The migratoriness is measured as the maximum distance between the median of the population distribution within a given year.  The median is a more reliable metric than the mean, as even as distributions become highly assymetric - pulling the mean in one directon or another - the median can  remain consistently in the middle of the spatial domain indicating a net flux of animals of 0. This is the anticipated (and realized) result of a purely "tactical" model pursuing the periodic resource pulses. 

To quantify the foraging efficiency, i.e., the organisms’ ability to track the distribution of the resources over space and time, we use a continuous form of the Bhattacharyya Coefficient [@Bhattacharyya1943] which quantifies the similarity between two distributions.  We compute this coefficient at every time point in a given year, and take the mean across the equilibrium year to determine foraging efficiency (FE). Thus, the foraging efficiency index is: 
$$FE = {1\over \tau} \int_{0}^\tau \int_{0}^{\chi} \sqrt{u(x,t) \, h(x,t)} \,\, dx\,dt$$
where the spatial integral is taken over the domain.  This metric is constraned to be between 0 and 1. 

Simulations are run until a (quasi)-equilibrium state is achieved, i.e. where the Bhattacharya index across subseqyuent years reaches a value of 0.9999.  Once that state is attained, we compute the mirgatoriness and foraging efficiency metrics, and additionally collect the number of years that were required to reach stationarity.  

## Simulation studies

We numerically solved this model using numerical differencing of a system of ordinary differential equations (ODE's) approximating the PDE in equation (2) with the Runge-Kutte algorithm using the `deSolve` [@Soetaert2010] and `ReacTran` [@Soetaert2012] packages in R.  

We assessed a wide range of parameter values and resource geometries and dynamics with the goal of answering the three main questions. 

Q1. What 

# Results

![](figures/ScanningResourceMemoryRatios_part1.png)

![](figures/FinalMigratoryFollowing.png){width=50%}

# Discussion

1. The model seems to - approximately - work for exploring this dynamic.
2. It is - however - difficult to make it really repeat previous behavior strongly. I was hoping for a "knob" that perfectly replicates past behavior, but the diffusion-taxis formulation makes that somehow hard.  I haven't programmed longer time scaled memories (> 1 year) but that would probably be helpful / interesting. 
3. The memory bit does demand iteratively feeding a year's cycle back into it rather than having some analytical function, which slows the whole thing down a bit. That said, with deepthought a lot of runs could be fitted simultaneously - and I tend to be very picky about "slow" - it actually only takes about 6 seconds to run a 6 year hybrid model on a 100 x 100 spatio-temporal grid.  But sometimes, the results are more numerically stable on a finer grid. 
4. We need a metric of success!  And also - somehow - a metric of "migratoriness". 
5. What questions do we wnat to explore?  I think a big one is adaptability of the model under different kinds of resource perturbations, e.g. if the timing shifts, or location shifts.



Our model is somewhat similar to an evolutionary individual-based model [@Anderson2013], which showed that some inherent phenotypic plasticity is required to hedge both against persistent trends and increased stochasticity of resource distributions, but at the risk of sub-optimal access to resources [@Anderson2013].  


# References

